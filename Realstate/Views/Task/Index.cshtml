@model IEnumerable<Realstate.Models.Struct.PredioViewModelTab>

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_RealState.cshtml";
}
@{
    var Idarea = (string)ViewData["Idareas"];
}

<h1>
    Areas de Prospección
</h1>
<ul class="nav nav-tabs">
    @{ var active = 0;
        var Idpredio = 0;}
    @foreach (var item in Model)
    {
        if (active == 0 && ViewBag.IdPredio_unique == "0")
        {
            <li role="presentation" class="mardis-nav active" id="@item.Id"><a href="@Url.Action("Index", "Task", new {IdArea = @item.IdZonaProspectada,idPredio=item.Id })">@item.Name</a></li>
            Idpredio = item.Id;
        }
        else
        {
            if (ViewBag.IdPredio_unique == @item.Id.ToString())
            {
                <li role="presentation" class="mardis-nav active" id="@item.Id"><a href="@Url.Action("Index", "Task", new { IdArea = @item.IdZonaProspectada, idPredio = item.Id })">@item.Name</a></li>
                Idpredio = item.Id;
            }
            else
            {

                <li role="presentation" class="mardis-nav" id="@item.Id"><a href="@Url.Action("Index", "Task", new {IdArea = @item.IdZonaProspectada,idPredio=item.Id })">@item.Name</a></li>
            }

        }
        active = 1;
    }
</ul>


<section class="content-header"></section>

<section class="content">
    <div class="row">
        <div class="col-md-3">

            @await Html.PartialAsync("_DataArea")


        </div>

        <div class="col-md-9">

            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs  ">
                    <li class="active"><a href="#mail" data-toggle="tab">Correo</a></li>
                    <li><a href="#reunion" data-toggle="tab">Reunión</a></li>
                    <li><a href="#note" data-toggle="tab">Notas</a></li>
                    <li><a href="#settings" data-toggle="tab">Campo</a></li>
                </ul>
            </div>
            <div class="tab-content">
                <div class="active tab-pane" id="mail">

                    @await Html.PartialAsync("_Message")
                </div>
                <div class="tab-pane" id="reunion">
                    @await Html.PartialAsync("_interaction")

                </div>
                <div class="tab-pane" id="note">

                    @await Html.PartialAsync("_Note")
                </div>
            </div>
            <br />
            <h3> Actividades </h3>
            @await Html.PartialAsync("_Timeline")

        </div>
</section>

@section scripts{
    <script src="~/Framework/bower_components/ckeditor/ckeditor.js"></script>
    <script src="~/Framework/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.js"></script>
    <script src="~/Helpers/taskHelpers.js"></script>
    <script src="~/js/jquery.toaster.js"></script>
    <script>

        //bootstrap WYSIHTML5 - text editor
        var IdPredioActivo = '@Html.Raw(Idpredio)';
        var IdPredioArea = '@Html.Raw(Idarea)';
        function SaveNota()
        {
            var a = CKEDITOR.instances['coment_note'].getData();
            SaveNotaAJAX(IdPredioActivo, IdPredioArea, a)
        }
        function SaveCorreo() {
        
            SaveMailAJAX(IdPredioActivo, $('#subject_msg').val(), $('#des_msg').val(), $('#coment_msg').val())


            $('#subject_msg').val('')
            $('#des_msg').val('')
            $('#coment_msg').val('')
        }
        function SaveRunion() {

            SaveReunionAJAX(IdPredioActivo, $('#subject_reu').val(), $('#reservationtime').val(), $('#coment_reu').val())


            $('#coment_reu').val('')
            $('#subject_reu').val('')
            $('#reservationtime').val('')
        }
        bindPredioID(IdPredioActivo);

       function tab_Perdio(id) {
                $(".mardis-nav").removeClass("active");
                var element = document.getElementById(id);
                element.classList.add("active");
                bindPredioID(id)
        }
        CKEDITOR.replace('coment_note')
        $('#reservationtime').daterangepicker({
            timePicker: true,
            startDate: moment().startOf('hour'),
            endDate: moment().startOf('hour').add(32, 'hour'),
            locale: {
                format: 'DD/MM/YYYY hh:mm'
            }
        }
        )
    </script>
}
